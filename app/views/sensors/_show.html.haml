%h4.text-center
  = succeed ':' do
    = t 'sensors.name'
  = @sensor.name

%h4.text-center
  = succeed ':' do
    = t 'sensors.id'
  = @sensor.id

%h5.text-center
  = succeed ':' do
    = t 'sensors.current_location'
  = @sensor.locations[0].latitude
  = @sensor.locations[0].longitude
  = @sensor.locations[0].height

.text-center
  - @readings.each do |measurement, _|
    .reading-chart{ id: "#{measurement.name}-container" }

- @readings.each do |measurement, readings|
  :javascript
    $(function () {
      $('##{measurement.name}-container').highcharts({
        title: {
          text: '#{measurement.name.capitalize}',
          x: -20 //center
        },
        xAxis: {
          type: 'datetime',
          labels: {
            formatter: function() {
              return Highcharts.dateFormat('%H:%M', this.value*1000);
            },
          }
        },
        yAxis: {
          title: {
            text: '[#{measurement.unit}]'
          },
          plotLines: [{
            value: 0,
            width: 1,
            color: '#808080'
          }]
        },
        tooltip: {
          formatter: function () {
            return '<div class="tooltip">' + Highcharts.dateFormat('%e %b %H:%M:%S', this.x * 1000) + '<br/><b>' + Highcharts.numberFormat(this.y) + ' [#{measurement.unit}]</b></div>';
          }
        },
        series: [{
          name: '#{measurement.name}',
          data: #{readings.map{ |r| [r.time.to_i, r.value.round(4)] }},
          showInLegend: false
        }]
      }, function(e) {
        setTimeout(function() {
          e.setSize($('##{measurement.name}-container').width(), $('##{measurement.name}-container').height());
        }, 1);
      });
    });
